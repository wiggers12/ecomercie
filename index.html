<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Cat√°logo Digital</title>
  <link href="https://fonts.googleapis.comcom/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2980b9; --secondary: #16a085; --dark1: #0d0d0d;
      --dark2: #1a1a1a; --dark3: #2c2c2c; --text: #ffffff; --accent: #1abc9c;
    }
    body { margin:0; font-family:'Poppins',sans-serif; background:var(--dark1); color:var(--text); }
    header { background:linear-gradient(90deg, var(--primary), var(--secondary)); padding:15px; font-size:22px; font-weight:700; text-align:center; }
    nav { display:flex; justify-content:center; flex-wrap:wrap; background:#1e1e1e; padding:5px 0; }
    nav button { background:var(--primary); border:none; margin:5px; padding:10px 15px; border-radius:8px; color:var(--text); font-weight:bold; cursor:pointer; transition: all 0.2s; }
    nav button:hover { background:var(--secondary); transform: translateY(-2px); }
    section { display:none; padding:20px; max-width:1200px; margin:auto; }
    h2 { color:var(--accent); margin:15px 0; border-bottom: 2px solid var(--dark3); padding-bottom: 10px;}
    h3 { color: #ccc; }
    label { font-size: 14px; color: #aaa; margin-top: 10px; display: block; }
    input, select { padding:12px; border:none; border-radius:6px; width:100%; box-sizing: border-box; margin:8px 0; background:var(--dark3); color:var(--text); font-size:16px; }
    input[type="file"] { background: var(--dark3); padding: 8px; }
    input[type="file"]::file-selector-button {
        background-color: var(--primary); color: var(--text); border: none;
        padding: 8px 12px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s;
    }
    input[type="file"]::file-selector-button:hover { background-color: var(--secondary); }
    .btn { background:var(--primary); display:block; width:100%; text-align:center; padding:12px; margin:15px 0; border-radius:6px; cursor:pointer; border:none; color:var(--text); font-weight:bold; font-size:16px; transition: background 0.2s; }
    .btn:hover { background:var(--secondary); }
    .list { background:var(--dark2); border-radius:8px; padding:15px; margin-top:10px; }
    .list div { padding:10px; border-bottom:1px solid #333; }
    #catalogoContainer { display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; }
    .prod-card { background:var(--dark2); border-radius:10px; overflow:hidden; text-align:center; transition:transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.5); display: flex; flex-direction: column;}
    .prod-card:hover { transform:scale(1.03); box-shadow: 0 6px 20px rgba(0,0,0,0.7); }
    .prod-card img { width:100%; height:180px; object-fit:cover; background-color: #555;}
    .prod-card-info { padding:15px; flex-grow: 1; }
    .prod-card-info h4 { margin:5px 0; font-size: 18px; }
    .prod-card-info p { margin:10px 0; color:var(--accent); font-weight:bold; font-size:20px; }
    .prod-card-actions { padding:0 15px 15px 15px; }
    .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background:rgba(0,0,0,0.85); backdrop-filter: blur(5px); }
    .modal-content { background:var(--dark2); margin:10% auto; padding:20px; border-radius:10px; max-width:700px; animation: slide-down 0.3s ease-out; }
    @keyframes slide-down { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .modal-header { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--accent); }
    .modal-header h2 { margin-top:0; }
    .close-btn { color:#aaa; font-size:32px; font-weight:bold; cursor:pointer; }
    .modal-body iframe, .modal-body video { width:100%; height:350px; border:none; border-radius:8px; margin-top:15px; background-color: #000; }
    #previewImagem { border-radius: 8px; border: 2px solid var(--dark3); }
  </style>
</head>
<body>
<header> Meu Cat√°logo Digital </header>
<nav>
  <button onclick="showTab('catalogo')">üõçÔ∏è Cat√°logo</button>
  <button onclick="showTab('clientes')">üë• Clientes</button>
  <button onclick="showTab('admin')">‚öôÔ∏è Admin</button>
</nav>

<section id="catalogo">
  <h2>Nossos Produtos</h2>
  <div id="catalogoContainer"></div>
</section>

<section id="clientes">
    <h2>Gest√£o de Clientes</h2>
    <h3>‚ûï Novo Cliente</h3>
    <input type="text" id="cliNome" placeholder="Nome Completo">
    <button class="btn" onclick="addCliente()">Adicionar Cliente</button>
    <h3>üìã Clientes Cadastrados</h3>
    <div class="list" id="listaClientes"></div>
</section>

<section id="admin">
  <h2>‚öôÔ∏è Painel de Administra√ß√£o</h2>
  <h3>üì¶ Adicionar Novo Produto ao Cat√°logo</h3>
  <input type="text" id="prodNome" placeholder="Nome do Produto">
  
  <label for="prodImagemInput">Imagem do Produto (M√°x 2MB)</label>
  <input type="file" id="prodImagemInput" accept="image/*">
  <img id="previewImagem" src="" alt="Pr√©via da imagem" style="max-width: 150px; display: none; margin: 10px 0;">
  
  <label for="prodVideoUrl">V√≠deo (escolha UMA op√ß√£o)</label>
  <input type="url" id="prodVideoUrl" placeholder="Op√ß√£o 1: Cole a URL do YouTube aqui">
  <input type="file" id="prodVideoInput" accept="video/*" style="margin-top:5px;">
  
  <input type="number" id="prodValor" placeholder="Pre√ßo do Produto (Ex: 129.90)">
  <button class="btn" onclick="addProduto()">‚ûï Adicionar Produto</button>
  
  <h3>üìã Produtos no Cat√°logo</h3>
  <div class="list" id="listaAdminProdutos"></div>
</section>

<div id="productModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalTitle"></h2>
      <span class="close-btn" onclick="closeModal()">&times;</span>
    </div>
    <div class="modal-body">
      <p style="font-size:22px; color:var(--accent); font-weight:bold;">Pre√ßo: R$ <span id="modalPrice"></span></p>
      <div id="modalVideoContainer"></div>
    </div>
  </div>
</div>

<script>
let dados = JSON.parse(localStorage.getItem("catalogoDigital")) || {
  clientes: [],
  catalogo: []
};

let imagemBase64 = null;
let videoObjectURL = null; // Guardar√° a URL tempor√°ria do v√≠deo

// --- FUN√á√ïES GERAIS ---
function save(){ 
  // ATEN√á√ÉO: URLs de v√≠deo local (videoObjectURL) n√£o s√£o salvas de forma persistente.
  // Elas s√£o perdidas ao recarregar a p√°gina. O que √© salvo √© apenas o texto da URL.
  localStorage.setItem("catalogoDigital", JSON.stringify(dados)); 
}
function showTab(tabId){
  document.querySelectorAll("section").forEach(s => s.style.display = "none");
  document.getElementById(tabId).style.display = "block";
  if(tabId === "catalogo") renderCatalogo();
  if(tabId === "clientes") renderClientes();
  if(tabId === "admin") renderAdminListaProdutos();
}

// --- SE√á√ÉO DE CLIENTES ---
function addCliente() {
    const nome = document.getElementById("cliNome").value.trim();
    if (!nome) { alert("O nome do cliente √© obrigat√≥rio!"); return; }
    dados.clientes.push({ id: Date.now(), nome });
    save(); 
    renderClientes(); 
    document.getElementById("cliNome").value = '';
}
function renderClientes() {
    let html = [...dados.clientes].reverse().map(c => `<div><b>${c.nome}</b></div>`).join('');
    document.getElementById("listaClientes").innerHTML = html || "<p>Nenhum cliente cadastrado.</p>";
}

// --- SE√á√ÉO ADMIN ---
function addProduto(){
  const nome = document.getElementById("prodNome").value.trim();
  const videoUrl = document.getElementById("prodVideoUrl").value.trim();
  const valor = parseFloat(document.getElementById("prodValor").value) || 0;

  // Prioriza o v√≠deo de upload se ambos forem fornecidos
  const finalVideoUrl = videoObjectURL || videoUrl;

  if(!nome || !imagemBase64 || valor <= 0){
    alert("Preencha Nome, selecione uma Imagem e defina um Pre√ßo!");
    return;
  }
  dados.catalogo.push({id: Date.now(), nome, imagemUrl: imagemBase64, videoUrl: finalVideoUrl, valor});
  save();
  renderAdminListaProdutos();
  alert("‚úÖ Produto adicionado ao cat√°logo!");
  
  // Limpa o formul√°rio
  document.getElementById("prodNome").value = '';
  document.getElementById("prodImagemInput").value = null;
  document.getElementById("previewImagem").style.display = 'none';
  document.getElementById("prodVideoUrl").value = '';
  document.getElementById("prodVideoInput").value = null;
  document.getElementById("prodValor").value = '';
  imagemBase64 = null;
  videoObjectURL = null;
}
function renderAdminListaProdutos(){
  let html = [...dados.catalogo].reverse().map(p => `<div><b>${p.nome}</b> - R$ ${p.valor.toFixed(2)}</div>`).join('');
  document.getElementById("listaAdminProdutos").innerHTML = html || "<p>Nenhum produto cadastrado.</p>";
}

// --- SE√á√ÉO CAT√ÅLOGO ---
function renderCatalogo(){
    const container = document.getElementById("catalogoContainer");
    container.innerHTML = dados.catalogo.map((p, index) => `
        <div class="prod-card">
            <img src="${p.imagemUrl}" alt="${p.nome}">
            <div class="prod-card-info">
                <h4>${p.nome}</h4>
                <p>R$ ${p.valor.toFixed(2)}</p>
            </div>
            <div class="prod-card-actions">
                <button class="btn" onclick="showProductDetail(${index})">Ver Detalhes</button>
            </div>
        </div>`).join('');
}

// --- MODAL DE DETALHES ---
function showProductDetail(index) {
    const produto = dados.catalogo[index];
    document.getElementById("modalTitle").innerText = produto.nome;
    document.getElementById("modalPrice").innerText = produto.valor.toFixed(2);
    
    const videoContainer = document.getElementById("modalVideoContainer");
    videoContainer.innerHTML = ''; // Limpa antes de adicionar

    if (produto.videoUrl) {
        if (produto.videoUrl.startsWith('blob:')) {
            // √â um v√≠deo de upload (URL tempor√°ria)
            const videoElement = document.createElement('video');
            videoElement.src = produto.videoUrl;
            videoElement.controls = true;
            videoContainer.appendChild(videoElement);
        } else if (produto.videoUrl.includes('youtube.com') || produto.videoUrl.includes('youtu.be')) {
            // √â um link do YouTube
            const embedUrl = convertToEmbedUrl(produto.videoUrl);
            const iframe = document.createElement('iframe');
            iframe.src = embedUrl;
            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
            iframe.allowFullscreen = true;
            videoContainer.appendChild(iframe);
        } else {
             videoContainer.innerHTML = "<p>Nenhum v√≠deo v√°lido fornecido.</p>";
        }
    } else {
        videoContainer.innerHTML = "<p>Nenhum v√≠deo dispon√≠vel para este produto.</p>";
    }
    document.getElementById("productModal").style.display = "block";
}
function closeModal() {
    document.getElementById("productModal").style.display = "none";
    document.getElementById("modalVideoContainer").innerHTML = ""; // Para o v√≠deo
}
function convertToEmbedUrl(url) {
    let videoId = '';
    try {
        if (url.includes("youtu.be/")) videoId = new URL(url).pathname.substring(1);
        else if (url.includes("watch?v=")) videoId = new URL(url).searchParams.get("v");
    } catch (e) { return ''; }
    return videoId ? `https://www.youtube.com/embed/${videoId}` : '';
}
window.onclick = function(event) {
    if (event.target == document.getElementById("productModal")) closeModal();
}

// --- SETUP DE EVENTOS PARA UPLOADS ---
document.getElementById('prodImagemInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('previewImagem');
    if (!file) { preview.style.display = 'none'; imagemBase64 = null; return; }
    if (file.size > 2 * 1024 * 1024) { // Limite de 2MB
        alert("Erro: A imagem √© muito grande! O limite √© de 2MB.");
        event.target.value = null; preview.style.display = 'none'; imagemBase64 = null; return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
        imagemBase64 = e.target.result;
        preview.src = imagemBase64;
        preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
});

document.getElementById('prodVideoInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (videoObjectURL) {
        // Limpa a URL anterior para n√£o ocupar mem√≥ria
        URL.revokeObjectURL(videoObjectURL);
        videoObjectURL = null;
    }
    if (file) {
        videoObjectURL = URL.createObjectURL(file);
        // Desabilita o campo de URL para evitar confus√£o
        document.getElementById('prodVideoUrl').disabled = true;
        document.getElementById('prodVideoUrl').value = "Upload de arquivo selecionado.";
    } else {
        document.getElementById('prodVideoUrl').disabled = false;
        document.getElementById('prodVideoUrl').value = "";
    }
});


// --- INICIALIZA√á√ÉO ---
showTab("catalogo");
</script>
</body>
</html>
