<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cat√°logo Moderno - Ecomercie</title>

  <!-- fonte -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --cor-primaria:#007BFF; --cor-secundaria:#1a3d5f; --cor-sucesso:#28a745; --cor-perigo:#dc3545;
      --cor-fundo:#f4f6f9; --cor-texto:#333; --cor-branca:#fff; --sombra:0 4px 12px rgba(0,0,0,.08);
      --radius:10px; --font:'Poppins',sans-serif;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:var(--font);background:var(--cor-fundo);color:var(--cor-texto)}
    header{background:var(--cor-branca);padding:20px 5%;box-shadow:var(--sombra);display:flex;gap:20px;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:1000;flex-wrap:wrap}
    h1{font-size:1.8em;color:var(--cor-primaria);font-weight:700}
    .search-container{flex-grow:1;max-width:500px;min-width:250px}
    #search-input{width:100%;padding:12px 20px;border:1px solid #ddd;border-radius:var(--radius);font-size:16px}
    main{padding:30px 5%}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:25px}
    .card{background:var(--cor-branca);border-radius:var(--radius);box-shadow:var(--sombra);transition:.3s;overflow:hidden;display:flex;flex-direction:column}
    .card:hover{transform:translateY(-8px);box-shadow:0 8px 20px rgba(0,0,0,.12)}
    .card img{width:100%;height:180px;object-fit:cover}
    .card-content{padding:15px;display:flex;flex-direction:column;flex-grow:1}
    .card h3{font-size:1.1em;font-weight:600;margin-bottom:5px}
    .price{font-size:1.2em;font-weight:700;color:var(--cor-primaria);margin:auto 0 12px}
    .add-to-cart-btn{background:var(--cor-primaria);color:#fff;border:none;padding:10px;border-radius:var(--radius);cursor:pointer;font-size:1em;font-weight:500;transition:.3s}
    .add-to-cart-btn:hover{background:var(--cor-secundaria)}

    .cart-icon{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:var(--cor-primaria);color:#fff;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:28px;cursor:pointer;box-shadow:0 4px 15px rgba(0,123,255,.4);z-index:1010;transition:transform .3s}
    .cart-icon:hover{transform:scale(1.1)}
    .cart-count{position:absolute;top:-5px;right:-5px;background:var(--cor-perigo);color:#fff;font-size:12px;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700}

    .cart-sidebar{position:fixed;top:0;right:-100%;width:100%;max-width:400px;height:100%;background:#fff;box-shadow:-5px 0 20px rgba(0,0,0,.15);transition:right .4s;z-index:1020;display:flex;flex-direction:column}
    .cart-sidebar.open{right:0}
    .cart-header{padding:20px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
    .cart-header h2{font-size:1.4em}
    .close-cart-btn{font-size:2em;cursor:pointer;background:none;border:none}
    #cart-items{flex-grow:1;overflow-y:auto;padding:20px}
    .cart-item{display:flex;align-items:center;margin-bottom:20px}
    .cart-item img{width:80px;height:80px;object-fit:cover;border-radius:var(--radius);margin-right:15px}
    .cart-item-info{flex-grow:1}
    .cart-item-info h4{margin-bottom:5px}
    .cart-item-info p{color:var(--cor-primaria);font-weight:600}
    .remove-item-btn{color:var(--cor-perigo);background:none;border:none;font-size:1.5em;cursor:pointer}
    #cart-empty-message{text-align:center;color:#888;margin-top:50px}
    .cart-footer{padding:20px;border-top:1px solid #eee}
    .cart-total{display:flex;justify-content:space-between;font-size:1.1em;font-weight:600;margin-bottom:15px}
    .payment-methods{text-align:center;margin-bottom:15px}
    .payment-methods img{height:25px;margin:0 5px;opacity:.7}
    .checkout-btn{width:100%;padding:15px;background:var(--cor-sucesso);color:#fff;border:none;border-radius:var(--radius);font-size:1.05em;font-weight:600;cursor:pointer}

    .pill{background:#eef2f7;color:#1f2430;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:700;margin-left:8px}

    @media (max-width:600px){
      main{padding:20px 15px}
      header{padding:15px;gap:15px;justify-content:center}
      h1{font-size:1.5em;width:100%;text-align:center}
      .grid{grid-template-columns:repeat(2,1fr);gap:15px}
      .card h3{font-size:1em}
      .price{font-size:1.1em}
      .cart-sidebar{max-width:100%}
    }
  </style>
</head>
<body>

  <header>
    <div style="display:flex;align-items:center;gap:10px;">
      <h1>Meu Cat√°logo</h1>
      <span id="tenant-pill" class="pill">Loja: ‚Äî</span>
    </div>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="O que voc√™ est√° procurando?">
    </div>
  </header>

  <main>
    <div class="grid" id="product-grid"></div>
  </main>

  <!-- Social -->
  <div class="social-buttons" style="position:fixed;top:50%;left:0;transform:translateY(-50%);z-index:1000;display:flex;flex-direction:column;gap:5px;">
    <a href="#" class="social-btn whatsapp" aria-label="WhatsApp" style="width:45px;height:45px;display:flex;justify-content:center;align-items:center;color:#fff;font-size:24px;text-decoration:none;border-top-right-radius:10px;border-bottom-right-radius:10px;background:#25D366">W</a>
    <a href="#" class="social-btn instagram" aria-label="Instagram" style="width:45px;height:45px;display:flex;justify-content:center;align-items:center;color:#fff;font-size:24px;text-decoration:none;border-top-right-radius:10px;border-bottom-right-radius:10px;background:radial-gradient(circle at 30% 107%,#fdf497 0%,#fdf497 5%,#fd5949 45%,#d6249f 60%,#285AEB 90%)">I</a>
    <a href="#" class="social-btn facebook" aria-label="Facebook" style="width:45px;height:45px;display:flex;justify-content:center;align-items:center;color:#fff;font-size:24px;text-decoration:none;border-top-right-radius:10px;border-bottom-right-radius:10px;background:#1877F2">f</a>
  </div>

  <!-- Carrinho -->
  <div class="cart-icon" id="cart-icon">üõí <span class="cart-count" id="cart-count">0</span></div>
  <div class="cart-sidebar" id="cart-sidebar">
    <div class="cart-header">
      <h2>Meu Carrinho</h2>
      <button class="close-cart-btn" id="close-cart-btn">&times;</button>
    </div>
    <div id="cart-items"><p id="cart-empty-message">Seu carrinho est√° vazio.</p></div>
    <div class="cart-footer">
      <div class="cart-total">
        <span>Total:</span><span id="cart-total">R$ 0,00</span>
      </div>
      <div class="payment-methods">
        <p style="font-size:14px;color:#888;margin-bottom:10px;">Formas de Pagamento:</p>
        <img src="https://img.icons8.com/color/48/000000/visa.png" alt="Visa">
        <img src="https://img.icons8.com/color/48/000000/mastercard.png" alt="Mastercard">
        <img src="https://img.icons8.com/color/48/000000/paypal.png" alt="PayPal">
        <img src="https://i.imgur.com/aO3l4p2.png" alt="Pix" style="height:25px;">
      </div>
      <button class="checkout-btn" id="checkout-btn">Finalizar Compra</button>
    </div>
  </div>

  <!-- Tawk.to (opcional) -->
  <script>
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
      var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
      s1.async=true; s1.src='https://embed.tawk.to/68b7b09d721af15d8752e01d/1j46ojqe8';
      s1.charset='UTF-8'; s1.setAttribute('crossorigin','*'); s0.parentNode.insertBefore(s1,s0);
    })();
  </script>

  <!-- Firebase (SEUS arquivos locais) -->
  <script src="/static/firebase-config.js"></script>
  <script src="/static/firebase-init.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    /* ========= util ========= */
    const BRL = new Intl.NumberFormat('pt-BR', { style:'currency', currency:'BRL' });
    const PLACEHOLDER = 'https://via.placeholder.com/600x400/eeeeee/888888?text=Produto';

    function getTenant(){
      const parts = location.pathname.split('/').filter(Boolean);
      // espera: /<tenant>/catalogo  -> tenant √© o primeiro segmento
      return parts.length >= 2 ? parts[0] : 'default';
    }
    const TENANT = getTenant();
    document.getElementById('tenant-pill').textContent = `Loja: ${TENANT}`;

    /* ========= estado ========= */
    let products = [];   // [{id,name,price,image}]
    let cart = [];

    /* ========= DOM ========= */
    const productGrid = document.getElementById('product-grid');
    const searchInput = document.getElementById('search-input');
    const cartIcon = document.getElementById('cart-icon');
    const cartSidebar = document.getElementById('cart-sidebar');
    const closeCartBtn = document.getElementById('close-cart-btn');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartCount = document.getElementById('cart-count');
    const cartTotal = document.getElementById('cart-total');
    const cartEmptyMessage = document.getElementById('cart-empty-message');
    const checkoutBtn = document.getElementById('checkout-btn');

    /* ========= render ========= */
    function productCard(p){
      return `
        <div class="card">
          <img src="${p.image || PLACEHOLDER}" alt="${p.name}">
          <div class="card-content">
            <h3>${p.name}</h3>
            <p class="price">${BRL.format(p.price || 0)}</p>
            <button class="add-to-cart-btn" data-id="${p.id}">Adicionar</button>
          </div>
        </div>`;
    }
    function renderProducts(list){
      productGrid.innerHTML = list.map(productCard).join('') || '<p style="opacity:.7">Nenhum produto dispon√≠vel.</p>';
    }
    function renderCart(){
      if (cart.length === 0){
        cartItemsContainer.innerHTML = '<p id="cart-empty-message">Seu carrinho est√° vazio.</p>';
      } else {
        cartItemsContainer.innerHTML = cart.map(item => `
          <div class="cart-item">
            <img src="${item.image || PLACEHOLDER}" alt="${item.name}">
            <div class="cart-item-info">
              <h4>${item.name}</h4>
              <p>${BRL.format(item.price || 0)}</p>
            </div>
            <button class="remove-item-btn" data-id="${item.id}">&times;</button>
          </div>
        `).join('');
      }
      cartCount.textContent = cart.length;
      const total = cart.reduce((s, i) => s + (Number(i.price)||0), 0);
      cartTotal.textContent = BRL.format(total);
    }

    /* ========= actions ========= */
    function addToCart(productId){
      const p = products.find(x => x.id === productId);
      if (p){ cart.push(p); renderCart(); }
    }
    function removeFromCart(productId){
      const ix = cart.findIndex(x => x.id === productId);
      if (ix > -1){ cart.splice(ix,1); renderCart(); }
    }

    /* ========= eventos ========= */
    searchInput.addEventListener('input', e => {
      const q = e.target.value.trim().toLowerCase();
      const filtered = products.filter(p => (p.name||'').toLowerCase().includes(q));
      renderProducts(filtered);
    });

    productGrid.addEventListener('click', e => {
      const btn = e.target.closest('.add-to-cart-btn');
      if (!btn) return;
      addToCart(parseInt(btn.dataset.id, 10));
    });

    cartItemsContainer.addEventListener('click', e => {
      const btn = e.target.closest('.remove-item-btn');
      if (!btn) return;
      removeFromCart(parseInt(btn.dataset.id, 10));
    });

    cartIcon.addEventListener('click', () => cartSidebar.classList.add('open'));
    closeCartBtn.addEventListener('click', () => cartSidebar.classList.remove('open'));

    checkoutBtn.addEventListener('click', async () => {
      if (cart.length === 0){ alert('Seu carrinho est√° vazio!'); return; }
      try{
        // se Firebase dispon√≠vel, grava ordem
        if (window.db && window.firebaseFns){
          const { addDoc, collection, serverTimestamp } = window.firebaseFns;
          const total = cart.reduce((s, i) => s + (Number(i.price)||0), 0);
          await addDoc(collection(window.db, 'tenants', TENANT, 'orders'), {
            items: cart.map(x => ({ id: x.id, name: x.name, price: Number(x.price)||0, image: x.image||null })),
            total,
            status: 'pending',
            createdAt: serverTimestamp()
          });
        }
        alert('Obrigado por sua compra! (Simula√ß√£o ‚Äî pedido registrado).');
        cart = [];
        renderCart();
        cartSidebar.classList.remove('open');
      }catch(err){
        console.error(err);
        alert('N√£o foi poss√≠vel registrar o pedido agora.');
      }
    });

    /* ========= dados ========= */
    async function loadProductsFromFirestore(){
      if (!window.db || !window.firebaseFns) throw new Error('Firebase indispon√≠vel no front');
      const { getDocs, collection, query, orderBy } = window.firebaseFns;
      const q = query(collection(window.db, 'tenants', TENANT, 'products'), orderBy('createdAt','desc'));
      const snap = await getDocs(q);
      const list = [];
      let autoId = 1;
      snap.forEach(doc => {
        const d = doc.data() || {};
        // aceita diferentes esquemas: images[], imageUrl, coverUrl
        const image = (d.images && d.images[0]) || d.imageUrl || d.coverUrl || PLACEHOLDER;
        list.push({
          id: d.sku || d.id || autoId++,
          name: d.name || d.title || 'Produto sem nome',
          price: Number(d.price) || 0,
          image
        });
      });
      return list;
    }

    async function init(){
      try{
        if (window.db && window.firebaseFns){
          products = await loadProductsFromFirestore();
          if (!products.length){
            // fallback visual se cole√ß√£o estiver vazia
            products = [
              { id: 1, name:'Exemplo 1', price: 199.90, image: PLACEHOLDER },
              { id: 2, name:'Exemplo 2', price: 399.00, image: PLACEHOLDER },
              { id: 3, name:'Exemplo 3', price: 89.50,  image: PLACEHOLDER }
            ];
          }
        } else {
          // fallback total sem Firebase
          products = [
            { id: 1, name:'Smartphone Pro', price:2999.90, image:'https://via.placeholder.com/600x400/007BFF/FFFFFF?text=Smartphone' },
            { id: 2, name:'Fone Bluetooth',  price:399.00,  image:'https://via.placeholder.com/600x400/6C757D/FFFFFF?text=Fone' },
            { id: 3, name:'Smartwatch 2',    price:899.50,  image:'https://via.placeholder.com/600x400/28A745/FFFFFF?text=Rel%C3%B3gio' },
            { id: 4, name:'Notebook Gamer',  price:7499.00, image:'https://via.placeholder.com/600x400/DC3545/FFFFFF?text=Notebook' }
          ];
        }
      }catch(err){
        console.error('Falha ao carregar do Firestore:', err);
        // fallback se erro
        products = [
          { id: 1, name:'Exemplo 1', price:199.90, image: PLACEHOLDER },
          { id: 2, name:'Exemplo 2', price:399.00, image: PLACEHOLDER },
          { id: 3, name:'Exemplo 3', price:89.50,  image: PLACEHOLDER }
        ];
      }
      renderProducts(products);
      renderCart();
    }

    init();
  });
  </script>
</body>
</html>